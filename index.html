<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Satoshi Overdrive v2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* --- ESTILOS GENERALES --- */
        :root {
            --bg-dark: #05000a;
            --card-bg: #130026;
            --primary: #8b5cf6;
            --ton-blue: #0098EA; /* Color oficial de TON */
        }
        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0; overflow: hidden; -webkit-tap-highlight-color: transparent;
        }
        .main-container {
            height: 100vh; overflow-y: auto; padding: 20px 20px 120px 20px; box-sizing: border-box;
            background-image: linear-gradient(rgba(139,92,246,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(139,92,246,0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-2 { gap: 8px; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }

        /* --- COMPONENTES --- */
        .card {
            background-color: rgba(19, 0, 38, 0.6); backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.05); border-radius: 2rem; padding: 20px; margin-bottom: 20px;
        }
        .btn {
            background: linear-gradient(to right, #7c3aed, #c026d3); border: none; color: white;
            padding: 16px; border-radius: 16px; font-weight: 900; text-transform: uppercase;
            width: 100%; cursor: pointer; margin-top: 10px;
        }
        /* Bot√≥n estilo TON */
        .btn-ton {
            background: linear-gradient(to right, #0098EA, #0077b6);
            box-shadow: 0 0 15px rgba(0, 152, 234, 0.4);
        }
        .btn:active { transform: scale(0.95); }

        /* --- VISTAS --- */
        .score-display { font-size: 3.5rem; font-weight: 900; margin: 10px 0; text-shadow: 0 0 20px rgba(255,255,255,0.3); }
        .clicker-container {
            position: relative; width: 260px; height: 260px; margin: 20px auto; display: flex; justify-content: center; align-items: center;
        }
        .clicker-btn {
            width: 200px; height: 200px; border-radius: 50%;
            background: radial-gradient(circle at center, #4c1d95, #0a0014);
            border: 2px solid rgba(139,92,246,0.5); box-shadow: 0 0 50px rgba(139,92,246,0.3);
            display: flex; justify-content: center; align-items: center; font-size: 60px; cursor: pointer; z-index: 10;
        }
        .clicker-btn:active { transform: scale(0.95); }

        /* --- NAVIGATION --- */
        .nav-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 350px; background: rgba(15, 5, 24, 0.95); backdrop-filter: blur(20px);
            border: 1px solid rgba(139,92,246,0.2); border-radius: 40px; display: flex; justify-content: space-around; padding: 10px; z-index: 100;
        }
        .nav-item { background: none; border: none; color: #64748b; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: #e879f9; }
        .nav-item span { font-size: 9px; font-weight: 900; margin-top: 4px; }

        /* --- ITEMS DE TIENDA --- */
        .shop-item {
            background: #130026; padding: 15px; border-radius: 15px; margin-bottom: 10px;
            border: 1px solid rgba(139,92,246,0.1); display: flex; justify-content: space-between; align-items: center;
        }
        .ton-item { border: 1px solid rgba(0, 152, 234, 0.3); background: rgba(0, 152, 234, 0.05); }
    </style>
</head>
<body>

    <div class="main-container">
        <div id="view-home">
            <div class="text-center" style="margin-top: 10px;">
                <h2 style="font-style: italic; font-weight: 900; margin: 0;">SATOSHI <span style="color: #facc15;">OD</span></h2>
                <div style="font-size: 12px; color: #a78bfa; margin-top: 5px;">POTENCIA TOTAL: <span id="total-rate">0</span> SATS/s</div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <div class="flex justify-between" style="font-size: 10px; font-weight: 900; color: #cbd5e1; text-transform: uppercase;">
                    <span>Almacenamiento</span>
                    <span id="storage-text">0 / 1000</span>
                </div>
                <div style="width: 100%; height: 6px; background: rgba(0,0,0,0.4); border-radius: 10px; margin: 10px 0;">
                    <div id="storage-bar" style="width: 0%; height: 100%; background: linear-gradient(to right, #06b6d4, #8b5cf6); border-radius: 10px;"></div>
                </div>
                <button onclick="claimAuto()" class="btn" style="padding: 10px; font-size: 12px; margin-top: 5px;">RECLAMAR MINADO</button>
            </div>

            <div class="text-center">
                <div class="score-display" id="score">0</div>
                <div style="font-size: 10px; font-weight: 900; color: #64748b; letter-spacing: 2px;">BALANCE TOTAL</div>
            </div>

            <div class="clicker-container">
                <div class="clicker-btn" id="coin-btn">‚Çø</div>
            </div>
            <div class="text-center" style="font-size: 12px; color: #facc15;">‚ö° <span id="energy">1000</span></div>
        </div>

        <div id="view-mine" class="hidden">
            <h2 class="text-center" style="font-style: italic;">HARDWARE</h2>
            
            <div style="margin-bottom: 20px;">
                <div style="font-size: 10px; color: #0098EA; font-weight: 900; margin-bottom: 10px; letter-spacing: 1px;">PREMIUM (PAGO EN TON)</div>
                <div id="ton-machines-list"></div>
            </div>

            <div>
                <div style="font-size: 10px; color: #a78bfa; font-weight: 900; margin-bottom: 10px; letter-spacing: 1px;">B√ÅSICO (PAGO EN SATS)</div>
                <div id="basic-machines-list"></div>
            </div>
        </div>

        <div id="view-wallet" class="hidden">
            <div class="card" style="background: linear-gradient(135deg, #1e1b4b, #130026);">
                <span style="font-size: 10px; color: rgba(255,255,255,0.5);">MI BILLETERA</span>
                <h1 style="margin: 10px 0;" id="wallet-balance">0</h1>
                <div style="font-size: 20px; color: #34d399; font-weight: bold; margin-top: 10px;" id="usdt-value">‚âà $0.00</div>
            </div>
            <p class="text-center" style="font-size: 12px; color: #64748b;">Retiros habilitados pr√≥ximamente en la Fase 2.</p>
        </div>
    </div>

    <div class="nav-dock">
        <button class="nav-item active" onclick="switchTab('home', this)">
            <i data-lucide="home" width="20"></i><span>BASE</span>
        </button>
        <button class="nav-item" onclick="switchTab('mine', this)">
            <i data-lucide="zap" width="20"></i><span>MINAR</span>
        </button>
        <button class="nav-item" onclick="switchTab('wallet', this)">
            <i data-lucide="wallet" width="20"></i><span>WALLET</span>
        </button>
    </div>

    <script>
        // CONFIGURACI√ìN DE TU BILLETERA (DONDE RECIBES LOS TON)
        const MY_WALLET = "UQAhKfWAyGxvnqR1J7ZUaJWs5xTJVJ2uTAMxB_vH-sL4zMt1";

        // CONFIGURACI√ìN DE M√ÅQUINAS TON
        const tonMachines = [
            { id: 1, name: "Starter Rig", cost: 1, power: 100, desc: "Aceleraci√≥n x10" },
            { id: 2, name: "Turbo Miner", cost: 5, power: 600, desc: "Aceleraci√≥n x60" },
            { id: 3, name: "Quantum Core", cost: 10, power: 1500, desc: "Potencia Industrial" },
            { id: 4, name: "GOD MODE", cost: 30, power: 5000, desc: "M√ÅXIMA POTENCIA" }
        ];

        // CONFIGURACI√ìN M√ÅQUINAS B√ÅSICAS (SATS)
        const basicMachines = [
            { id: 101, name: "CPU B√°sico", cost: 500, power: 1 },
            { id: 102, name: "GPU Usada", cost: 2000, power: 5 }
        ];

        // VARIABLES DE ESTADO
        let score = 0;
        let energy = 1000;
        let miningRate = 0; // SATS por segundo
        let autoBalance = 0;
        const MAX_STORAGE = 1000;

        // INICIALIZAR
        lucide.createIcons();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ELEMENTOS DOM
        const els = {
            score: document.getElementById('score'),
            walletScore: document.getElementById('wallet-balance'),
            usdt: document.getElementById('usdt-value'),
            energy: document.getElementById('energy'),
            rate: document.getElementById('total-rate'),
            storageBar: document.getElementById('storage-bar'),
            storageText: document.getElementById('storage-text'),
            tonList: document.getElementById('ton-machines-list'),
            basicList: document.getElementById('basic-machines-list')
        };

        // RENDERIZAR TIENDA
        function renderShop() {
            // Render TON Machines
            els.tonList.innerHTML = tonMachines.map(m => `
                <div class="shop-item ton-item">
                    <div>
                        <div style="font-weight:900; font-size:14px;">${m.name}</div>
                        <div style="font-size:10px; color:#0098EA;">+${m.power} SATS/s</div>
                        <div style="font-size:9px; color:#64748b;">${m.desc}</div>
                    </div>
                    <button class="btn btn-ton" style="width:auto; padding:8px 16px; margin:0;" onclick="buyWithTon(${m.id})">
                        üíé ${m.cost} TON
                    </button>
                </div>
            `).join('');

            // Render Basic Machines
            els.basicList.innerHTML = basicMachines.map(m => `
                <div class="shop-item">
                    <div>
                        <div style="font-weight:900; font-size:14px;">${m.name}</div>
                        <div style="font-size:10px; color:#a78bfa;">+${m.power} SATS/s</div>
                    </div>
                    <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:10px; background:#2d1245;" onclick="buyBasic(${m.id})">
                        ${m.cost} SATS
                    </button>
                </div>
            `).join('');
        }

        // L√ìGICA DE COMPRA TON
        function buyWithTon(id) {
            const machine = tonMachines.find(m => m.id === id);
            
            // Convertir TON a NanoTON (1 TON = 1,000,000,000)
            const nanoAmount = machine.cost * 1000000000;
            const text = `Pago_${machine.name}_User_${tg.initDataUnsafe?.user?.id || 'Anon'}`;
            
            // Crear Link de Pago Universal (Abre Tonkeeper o Wallet)
            const paymentUrl = `https://app.tonkeeper.com/transfer/${MY_WALLET}?amount=${nanoAmount}&text=${text}`;

            // Abrir pago
            tg.openLink(paymentUrl);

            // SIMULACI√ìN DE VERIFICACI√ìN (Ya que no tenemos backend)
            tg.showConfirm(`¬øConfirmas que has realizado el pago de ${machine.cost} TON en tu billetera?`, (confirmed) => {
                if (confirmed) {
                    // Esperar un poco para dar sensaci√≥n de "Verificando blockchain..."
                    tg.showAlert("Verificando transacci√≥n en la blockchain...");
                    setTimeout(() => {
                        miningRate += machine.power;
                        updateUI();
                        tg.showAlert(`‚úÖ ¬°PAGO CONFIRMADO! \n\nHas adquirido ${machine.name}. \nTu potencia aument√≥ +${machine.power} SATS/s.`);
                    }, 2000);
                }
            });
        }

        // L√ìGICA COMPRA B√ÅSICA
        function buyBasic(id) {
            const m = basicMachines.find(x => x.id === id);
            if (score >= m.cost) {
                score -= m.cost;
                miningRate += m.power;
                tg.showAlert(`¬°Mejora comprada! +${m.power} SATS/s`);
                updateUI();
            } else {
                tg.showAlert("Saldo insuficiente.");
            }
        }

        // BUCLE PRINCIPAL (Se ejecuta cada segundo)
        setInterval(() => {
            // Miner√≠a Pasiva (Rate)
            if (miningRate > 0) {
                score += miningRate;
            }
            
            // Auto Collector (Llenado lento base)
            if (autoBalance < MAX_STORAGE) {
                autoBalance += 1; 
            }
            
            // Regenerar Energ√≠a Clicker
            if (energy < 1000) energy += 2;

            updateUI();
        }, 1000);

        // ACTUALIZAR INTERFAZ
        function updateUI() {
            els.score.innerText = Math.floor(score).toLocaleString();
            els.walletScore.innerText = Math.floor(score).toLocaleString();
            els.usdt.innerText = `‚âà $${(score / 1000000).toFixed(4)}`; // Precio simulado
            els.energy.innerText = energy;
            els.rate.innerText = miningRate;
            
            // Barra de almacenamiento
            els.storageText.innerText = `${Math.floor(autoBalance)} / ${MAX_STORAGE}`;
            els.storageBar.style.width = `${(autoBalance/MAX_STORAGE)*100}%`;
        }

        // CLAIM DEL AUTO COLLECTOR
        function claimAuto() {
            if (autoBalance > 0) {
                score += autoBalance;
                tg.showAlert(`Recogiste ${Math.floor(autoBalance)} SATS`);
                autoBalance = 0;
                updateUI();
            }
        }

        // CLICKER
        document.getElementById('coin-btn').addEventListener('click', (e) => {
            if(energy > 0) {
                score++;
                energy--;
                if(navigator.vibrate) navigator.vibrate(10);
                updateUI();
                
                // Efecto visual simple
                const el = document.createElement('div');
                el.innerText = "+1";
                el.style.position = 'fixed';
                el.style.left = e.clientX + 'px';
                el.style.top = e.clientY + 'px';
                el.style.color = 'white';
                el.style.pointerEvents = 'none';
                el.style.fontWeight = 'bold';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 500);
            }
        });

        // CAMBIAR PESTA√ëAS
        function switchTab(tab, btn) {
            ['home', 'mine', 'wallet'].forEach(t => document.getElementById('view-'+t).classList.add('hidden'));
            document.getElementById('view-'+tab).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // INICIAR
        renderShop();
        updateUI();

    </script>
</body>
</html>
