<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Satoshi Overdrive Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

    <style>
        :root { --bg-dark: #05000a; --ton-blue: #0098EA; }
        body { background-color: var(--bg-dark); color: white; font-family: sans-serif; margin: 0; padding: 0; user-select: none; }
        .main-container { padding: 20px 20px 100px 20px; height: 100vh; overflow-y: auto; box-sizing: border-box; }
        .hidden { display: none !important; }
        .card { background: rgba(19, 0, 38, 0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; margin-bottom: 15px; }
        .btn { background: linear-gradient(90deg, #7c3aed, #db2777); border: none; color: white; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-ton { background: #0098EA; }
        .nav-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(20,20,40,0.9); padding: 10px 30px; border-radius: 50px; display: flex; gap: 30px; border: 1px solid rgba(255,255,255,0.1); z-index: 100; }
        .nav-item { color: #666; background: none; border: none; font-size: 24px; cursor: pointer; }
        .nav-item.active { color: #d946ef; }
        #coin-btn { width: 220px; height: 220px; background: radial-gradient(circle, #4c1d95, #000); border-radius: 50%; border: 4px solid #7c3aed; margin: 20px auto; display: flex; justify-content: center; align-items: center; font-size: 80px; box-shadow: 0 0 50px rgba(124, 58, 237, 0.5); }
        #coin-btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div class="main-container">
        <div id="view-home">
            <h2 style="text-align:center; margin:0;">SATOSHI <span style="color:#facc15">OD</span></h2>
            <p style="text-align:center; font-size:12px; color:#aaa;">POTENCIA: <span id="rate">0</span> SATS/s</p>
            
            <div class="card">
                <div style="display:flex; justify-content:space-between; font-size:12px; color:#ccc;">
                    <span>ALMAC√âN</span> <span id="storage-txt">0/1000</span>
                </div>
                <div style="background:#333; height:5px; margin:5px 0; border-radius:5px;"><div id="storage-bar" style="background:#06b6d4; width:0%; height:100%;"></div></div>
                <button class="btn" onclick="claim()">RECLAMAR</button>
            </div>

            <div style="text-align:center; margin: 20px 0;">
                <h1 id="score" style="font-size:50px; margin:0;">0</h1>
                <small style="color:#666; font-weight:bold;">BALANCE TOTAL</small>
            </div>

            <div id="coin-btn">‚Çø</div>
            <p style="text-align:center; color:#facc15;">‚ö° <span id="energy">1000</span></p>
        </div>

        <div id="view-mine" class="hidden">
            <h2 style="text-align:center;">HARDWARE</h2>
            <div id="shop-list"></div>
        </div>

        <div id="view-wallet" class="hidden">
            <div class="card" style="text-align:center;">
                <h3>MI BILLETERA</h3>
                <h1 id="wallet-score">0</h1>
                <p style="color:#34d399;" id="usdt-val">‚âà $0.00</p>
                <div id="ton-connect" style="margin-top:20px; display:flex; justify-content:center;"></div>
            </div>
        </div>
    </div>

    <div class="nav-dock">
        <button class="nav-item active" onclick="go('home', this)">üè†</button>
        <button class="nav-item" onclick="go('mine', this)">‚ö°</button>
        <button class="nav-item" onclick="go('wallet', this)">üíé</button>
    </div>

    <script>
        // CONFIGURACI√ìN CR√çTICA
        // ¬°ASEG√öRATE QUE ESTA URL COINCIDA CON TU NOMBRE DE REPO EN GITHUB!
        // Basado en tu foto, tu repo es "MININGSATOSHIPRO"
        const MANIFEST_URL = "https://Kevin7041.github.io/MININGSATOSHIPRO/tonconnect-manifest.json";
        const ADMIN_WALLET = "UQAhKfWAyGxvnqR1J7ZUaJWs5xTJVJ2uTAMxB_vH-sL4zMt1";

        const tg = window.Telegram.WebApp;
        tg.expand();
        const connector = new TON_CONNECT_UI.TonConnectUI({ manifestUrl: MANIFEST_URL, buttonRootId: 'ton-connect' });

        let data = { score: 0, energy: 1000, rate: 0, storage: 0 };
        
        // Cargar datos guardados
        if(localStorage.getItem('save_v2')) data = JSON.parse(localStorage.getItem('save_v2'));

        const machines = [
            { id: 1, name: "Starter Rig", price: 1, rate: 100 },
            { id: 2, name: "Turbo Miner", price: 5, rate: 600 },
            { id: 3, name: "God Mode", price: 30, rate: 5000 }
        ];

        function save() { localStorage.setItem('save_v2', JSON.stringify(data)); }
        setInterval(save, 5000);

        function render() {
            document.getElementById('score').innerText = Math.floor(data.score);
            document.getElementById('wallet-score').innerText = Math.floor(data.score);
            document.getElementById('usdt-val').innerText = "‚âà $" + (data.score/1000000).toFixed(4);
            document.getElementById('rate').innerText = data.rate;
            document.getElementById('energy').innerText = data.energy;
            document.getElementById('storage-txt').innerText = Math.floor(data.storage) + "/1000";
            document.getElementById('storage-bar').style.width = (data.storage/10) + "%";
        }

        // Tienda
        const shop = document.getElementById('shop-list');
        machines.forEach(m => {
            shop.innerHTML += `
            <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <div><b>${m.name}</b><br><small style="color:#0098EA">+${m.rate} SATS/s</small></div>
                <button class="btn btn-ton" style="width:auto; padding:10px 20px;" onclick="buy(${m.id})">${m.price} TON</button>
            </div>`;
        });

        async function buy(id) {
            if(!connector.connected) return tg.showAlert("‚ùå Conecta tu Wallet primero.");
            const m = machines.find(x => x.id == id);
            const transaction = {
                validUntil: Math.floor(Date.now()/1000)+600,
                messages: [{ address: ADMIN_WALLET, amount: (m.price*1000000000).toString() }]
            };
            try {
                await connector.sendTransaction(transaction);
                data.rate += m.rate;
                tg.showAlert("‚úÖ ¬°Compra exitosa! Potencia aumentada.");
                save();
            } catch(e) { tg.showAlert("‚ùå Pago cancelado."); }
        }

        // Clicker & Bucles
        document.getElementById('coin-btn').onclick = () => {
            if(data.energy > 0) { data.score++; data.energy--; render(); if(navigator.vibrate) navigator.vibrate(10); }
        };
        
        function claim() { data.score += data.storage; data.storage = 0; render(); }
        
        setInterval(() => {
            if(data.rate > 0) data.score += data.rate;
            if(data.storage < 1000) data.storage++;
            if(data.energy < 1000) data.energy++;
            render();
        }, 1000);

        function go(view, btn) {
            document.querySelectorAll('[id^=view-]').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-'+view).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        render();
    </script>
</body>
</html>
